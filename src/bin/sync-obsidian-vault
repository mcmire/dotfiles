#!/bin/bash

main() {
  local command_args=()
  local repo_directory
  local wants_help=0

  while [[ $# -gt 0 ]]; do
    case "$1" in
      --repo-directory | -d)
        repo_directory="$2"
        shift 2
        ;;
      --help | -h)
        wants_help=1
        command_args+=("$1")
        shift
        ;;
      *)
        command_args+=("$1")
        shift
        ;;
    esac
  done

  if [[ $wants_help -eq 1 ]]; then
    echo "This is a wrapper around the sync script in an Obsidian vault repo."
    if [[ -n $repo_directory ]]; then
      echo "The help message from this script follows."
      echo
    fi
  fi

  if [[ -z $repo_directory ]]; then
    if [[ $wants_help -eq 1 ]]; then
      echo "You can specify the repo (and get more specific help) by passing --repo-directory in addition to --help."
      return 0
    else
      echo "ERROR: Missing required option: --repo-directory" >&2
      return 1
    fi
  fi

  cd "$repo_directory" || return $?
  bash _scripts/sync.sh "${command_args[@]}"
}

main "$@"
