#!/bin/bash

# This script is designed to be run within a launch agent or init sript and
# therefore executables may not be on the PATH.
#
# On macOS, you can get this by running: `brew install watchexec`
# On Termux, you can get this by running: `pkg install watchexec`
path_to_watchexec=
if [[ -e /data/data/com.termux/files/usr/bin/watchexec ]]; then
  path_to_watchexec=/data/data/com.termux/files/usr/bin/watchexec
elif [[ -e /opt/homebrew/bin/watchexec ]]; then
  path_to_watchexec=/opt/homebrew/bin/watchexec
else
  echo "ERROR: Could not find watchexec"
  exit 1
fi

exec $path_to_watchexec \
  --watch "$HOME/obsidian-vault" \
  --on-busy-update=restart \
  --debounce 5s \
  $HOME/.bin/debounce \
  --duration 120 \
  -- \
  $HOME/.bin/sync-obsidian-vault-with-logging "$@"
